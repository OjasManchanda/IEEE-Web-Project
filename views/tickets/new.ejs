<% layout('partials/boilerplate') -%>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h2>üé´ List New Ticket</h2>
        </div>
        <div class="card-body">
          <form action="/tickets" method="POST" novalidate class="needs-validation">
            <!-- Event Name -->
            <div class="mb-3">
              <label class="form-label">Event Name *</label>
              <input type="text" name="ticket[eventName]" class="form-control" placeholder="Concert, Match, Play, etc." required
                autofocus />
              <div class="invalid-feedback">Please provide an event name.</div>
            </div>

            <!-- Event Date -->
            <div class="mb-3">
              <label class="form-label">Event Date *</label>
              <input type="date" name="ticket[eventDate]" class="form-control" required min="<%= new Date().toISOString().split('T')[0] %>" />
              <div class="invalid-feedback">Please select a valid event date.</div>
            </div>

            <!-- Location -->
            <div class="mb-3">
              <label class="form-label">Location *</label>
              <input type="text" name="ticket[location]" class="form-control" placeholder="Venue address" required />
              <div class="invalid-feedback">Please provide a location.</div>
            </div>

            <!-- Category -->
            <div class="mb-3">
              <label class="form-label">Category *</label>
              <select name="ticket[eventCategory]" class="form-select" required>
                <option value="">Select a category</option>
                <option value="Concert">Concert</option>
                <option value="Sports">Sports</option>
                <option value="Theatre">Theatre</option>
                <option value="Festival">Festival</option>
                <option value="Comedy">Comedy</option>
                <option value="Other">Other</option>
              </select>
              <div class="invalid-feedback">Please select a category.</div>
            </div>

            <!-- Base Price -->
            <div class="mb-3">
              <label class="form-label">Base Price (‚Çπ) *</label>
              <input type="number" name="ticket[basePrice]" class="form-control" placeholder="200" min="1" required />
              <div class="invalid-feedback">Please provide a valid price.</div>
            </div>

            <!-- Total Seats -->
            <div class="mb-3">
              <label class="form-label">Total Seats *</label>
              <input type="number" name="ticket[totalSeats]" class="form-control" placeholder="100" min="1" required />
              <div class="invalid-feedback">Please provide the total number of seats.</div>
            </div>

            <!-- Description -->
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea name="ticket[description]" class="form-control" rows="3"
                placeholder="Additional details about the event..."></textarea>
            </div>

            <!-- Hidden fields for initial state -->
            <input type="hidden" name="ticket[pricePerTicket]" id="pricePerTicket" value="0" />
            <input type="hidden" name="ticket[ticketsAvailable]" id="ticketsAvailable" value="0" />

            <div class="d-grid">
              <button class="btn btn-primary btn-lg" type="submit">
                üé´ List Ticket
              </button>
            </div>

            <hr class="my-3">
            <a href="/tickets" class="btn btn-secondary">‚Üê Back to Tickets</a>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Set initial values when form is submitted
  document.querySelector('form').addEventListener('submit', function(e) {
    const basePrice = document.querySelector('input[name="ticket[basePrice]"]').value;
    const totalSeats = document.querySelector('input[name="ticket[totalSeats]"]').value;
    
    // Set both pricePerTicket and ticketsAvailable to initial values
    document.getElementById('pricePerTicket').value = basePrice;
    document.getElementById('ticketsAvailable').value = totalSeats;
  });
</script>