<% layout('partials/boilerplate') -%>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>My Booked Tickets</h1>
  <a href="/tickets" class="btn btn-primary">‚Üê Browse Tickets</a>
</div>

<% if (tickets.length === 0) { %>
  <div class="alert alert-info text-center" role="alert">
    <h4>You haven't booked any tickets yet!</h4>
    <p>Browse available tickets and book your next event.</p>
    <a href="/tickets" class="btn btn-primary">Find Tickets</a>
  </div>
<% } else { %>
  <div class="row">
    <% tickets.forEach(ticket => { %>
      <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header bg-info text-white">
            <div class="d-flex justify-content-between align-items-center">
              <span class="badge bg-light text-dark"><%= ticket.eventCategory %></span>
              <span class="badge bg-success">BOOKED</span>
            </div>
          </div>
          <div class="card-body">
            <h5 class="card-title"><%= ticket.eventName %></h5>
            <p class="card-text">
              <small class="text-muted">
                üìÖ <%= ticket.eventDate.toLocaleDateString('en-IN', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' }) %>
              </small>
            </p>
            <p class="card-text">
               <strong><%= ticket.location %></strong><br />
               <strong class="text-success">‚Çπ<%= ticket.pricePerTicket.toLocaleString('en-IN') %></strong> per ticket<br />
               <strong>Booking ID:</strong> <%= ticket.bookingId %>
            </p>
            <p class="card-text">
              <small class="text-muted">Booked on: <%= ticket.bookingDate.toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' }) %></small>
            </p>
          </div>
          <div class="card-footer bg-transparent">
            <a href="/tickets/<%= ticket._id %>/confirmation" class="btn btn-info w-100 mb-2">View Details</a>
            <a href="/tickets/<%= ticket._id %>/cancel" class="btn btn-danger w-100"
               onclick="return confirm('Are you sure you want to cancel this ticket? A refund will be initiated.')">
              Cancel Ticket
            </a>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
<% } %>