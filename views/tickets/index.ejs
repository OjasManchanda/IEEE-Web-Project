<% layout('partials/boilerplate') -%>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Available Tickets</h1>
  <% if (currentUser) { %>
    <a href="/tickets/new" class="btn btn-success">+ Sell Ticket</a>
  <% } %>
</div>

<% if (tickets.length === 0) { %>
  <div class="alert alert-info text-center" role="alert">
    <h4>No tickets available yet!</h4>
    <p>Be the first to list a ticket.</p>
    <% if (currentUser) { %>
      <a href="/tickets/new" class="btn btn-primary">List a Ticket</a>
    <% } %>
  </div>
<% } else { %>
  <div class="row">
    <% tickets.forEach(ticket => { %>
      <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header bg-primary text-white">
            <span class="badge bg-light text-dark"><%= ticket.eventCategory %></span>
          </div>
          <div class="card-body">
            <h5 class="card-title"><%= ticket.eventName %></h5>
            <p class="card-text">
              <small class="text-muted">
                ðŸ“… <%= ticket.eventDate.toLocaleDateString('en-IN', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' }) %>
              </small>
            </p>
            <p class="card-text">
               <strong><%= ticket.location %></strong><br />
               <strong class="text-success">â‚¹<%= ticket.pricePerTicket.toLocaleString('en-IN') %></strong> per ticket<br />
               <strong><%= ticket.ticketsAvailable %></strong> available
            </p>
            <% if (ticket.owner && ticket.owner.username) { %>
              <p class="card-text">
                <small class="text-muted">Seller: <%= ticket.owner.username %></small>
              </p>
            <% } %>
          </div>
          <div class="card-footer bg-transparent">
            <a href="/tickets/<%= ticket._id %>" class="btn btn-primary w-100">View Details</a>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
<% } %>
